---
title: "National Parks Analysis"
author: "Us!"
date: "8/22/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The plan

We'll be mob programming in small teams to learn ggplot2. We'll be exploring data on visits to US National Parks (sourced from the National Park Service at https://irma.nps.gov/Stats/SSRSReports).  


The presentation is [here]().


## Load libraries and data 

The `tidyverse` package has `ggplot2`, as well as `dplyr`, which we will use today.

```{r load, message=FALSE, warning=FALSE}
library(tidyverse) # install.packages('tidyverse')

np_visit <- read_csv("data/np_visit.csv")
```

## Demo code

```{r, warning=FALSE, message=FALSE}
library(tidyverse)

np_visit <- read_csv("data/np_visit.csv")

dino_nm <- np_visit %>% 
  filter(park_name == "Dinosaur National Monument")
  
ggplot(data = dino_nm, aes(x = year, y = visitors)) +
  geom_point()
```


## Exploring and wrangling data, pre-plotting // renamed

To get a better sense of the dataset and what we may want to plot, we can do some preliminary wrangling/exploration.

Here are some common functions: 

- head
- tail
- summary()
- View()

Some geoms: 
-


## Plotting questions

### How many parks in each region?

Add text: The "region" varible defines the US by region. Use a bargraph to show how many parks are in each region. 

Hint: `geom_bar`

```{r}
## wrangling code:
per_state <- np_visit %>% 
  group_by(state) %>% 
  mutate(n_parks = n()) %>% 
  select(state, n_parks) %>% 
  distinct() %>% 
  arrange(desc(n_parks)) %>% 
  ungroup()

## plotting code:

```



These are some questions you can answer as you figure out what to plot

```{r}

## General exploration of the dataset
head(np_visit)
summary(np_visit)

## How many years of data does this dataset have? hint: summary()

## Which parks, and how many parks, are in the dataset?
parks <- np_visit %>% 
  select(park_name) %>% 
  distinct()

## When was each park founded? Which are the oldest vs newest?
earliest_yr <- np_visit %>% 
  select(park_name, year) %>% 
  group_by(park_name) %>% 
  slice(which.min(year)) %>%
  arrange(year) %>% 
  ungroup()

head(earliest_yr)
tail(earliest_yr)



head(per_state)
tail(per_state)

per_rgn <- np_visit %>% 
  group_by(region) %>% 
  mutate(n_parks = n()) %>% 
  select(region, n_parks) %>% 
  distinct() %>% 
  arrange(desc(n_parks)) %>% 
  ungroup()

## Which is the most visited national park? Which year? How many visitors?
most_visit <- np_visit %>% 
  arrange(desc(visitors))



## Which was the most visited national park in the US in 2016?
most_visit_2016 <- np_visit %>% 
  filter(year == 2016) %>% 
  arrange(desc(visitors))

## And the least visited park in 2016
tail(most_visit_2016)


```

##

- How many years of data does this dataset have? hint: summary()

- Which parks, and how many parks, are in the dataset?


## Challenge questions


## Demo plots


```{r}
ggplot(data = earliest_yr, aes(year)) + geom_histogram(binwidth = 1) # single year
ggplot(data = earliest_yr, aes(year)) + geom_histogram(binwidth = 10) # decade

rgn_visits <- np_visit %>% 
  group_by(region, year) %>% 
  mutate(rgn_visit = sum(as.numeric(visitors))/10^4) %>% 
  ungroup() %>% 
  filter(rgn_visit > 0)

ggplot(data = rgn_visits, aes(x = year, y = rgn_visit, colour = region)) + 
  geom_line()
```

## Your turn!

Here are some questions to get you started: 

1. Can you create a plot that shows the trend in visitation to your favorite national park over time
2. How many national parks were established in each year in the US between XXXX and XXXX
3. 
